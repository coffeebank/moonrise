<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ page.serverName }}</title>
    <meta name="description" content="{{ page.serverDescription }}">
    <link rel="shortcut icon" href="media/favicon.ico" />
    <link rel="apple-touch-icon" sizes="180x180" href="media/apple-touch-icon.png">

    <!-- don't show this site on search engines -->
    {% if page.showinSearchEngines == true %}
        <meta name="robots" content="index">
    {% else %}
        <meta name="robots" content="noindex">
    {% endif %}

    <!-- css and fonts -->
    <link href="styles.css" rel="stylesheet">
    <link href="https://unpkg.com/tailwindcss@^1.0/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Jost:wght@400;500;700&display=swap" rel="stylesheet">

    <!-- set chrome and embed site color -->
    <meta name="theme-color" content="#272727">

    <!-- social media -->
    <meta property="og:title" content="{{ page.serverName }} - Minecraft Server">
    <meta property="og:description" content="{{ page.serverDescription }}">
    <meta property="og:image" content="{{ page.siteIcon }}">
    <meta property="og:url" content="{{ page.siteURL }}">

</head>
<body>
    <!-- navbar -->
    <nav class="flex items-center justify-between flex-wrap bg-transparent p-6">
        <div class="flex items-center flex-shrink-0 text-white mr-6 select-none">
          <img src="{{ page.siteIcon }}" class="mr-4 rounded shadow" width="30px" alt="{{ page.serverName }}">
          <span class="font-semibold text-xl tracking-tight hidden md:block" id="serverLogoName">{{ page.serverName }}</span>
        </div>
        <div class="block flex-grow flex items-center w-auto">
            <div class="text-sm flex-grow">
                {% for nlink in siteNav %}
                    <a href="{{ nlink.nurl }}" rel="noopener" class="block inline-block text-teal-200 hover:text-white mr-4">
                        {{ nlink.nname }}
                    </a>
                {% endfor %}
          </div>
          <div id="serverStatus" class="text-gray-200 hidden md:block cursor-pointer"></div>
        </div>
        <div class="block md:hidden">
            <div id="serverStatusM" class="text-gray-200 py-2 md:py-4"></div>
        </div>

        <!-- show loading for status API only if javascript is enabled -->
        <script>
          document.getElementById('serverStatus').innerHTML = `Loading...`
          document.getElementById('serverStatusM').innerHTML = `Loading...`
        </script>

    </nav>

    <!-- lead section -->
    <div class="flex flex-wrap md:flex-row-reverse justify-center items-center text-center py-4">
        <div class="w-full lg:w-1/2">
            <h1 class="text-4xl text-gray-100 pt-12 md:pt-0">{{ page.serverName }}</h1>
            <h2 class="text-2xl text-gray-200 pt-6" id="serverVer">Minecraft Server</h2>

            <div class="rounded overflow-hidden w-full sm:w-4/5 md:w-3/4 mx-auto mt-10 mb-6">
                <div class="px-6 py-4">
                    <div class="text-sm font-thin -mb-3" id="serverPlaynow">
                        <span class="inline-block bg-yellow-500 rounded-full px-3 py-1 text-sm font-thin uppercase text-gray-900 mr-2 shadow-lg">Play Now</span>
                    </div>
                    <p class="text-gray-100 text-base bg-green-900 rounded py-6 px-3 sm:text-xl md:text-2xl font-mono overflow-hidden shadow-xl select-all" id="serverIP" data-clipboard-text="{{ page.serverIP }}">
                        {{ page.serverIP }}
                    </p>
                </div>
            </div>
            
            <a href="{{ page.discordInvite }}" rel="noopener">
                <button class="w-4/5 md:w-1/2 xl:w-1/3 mb-2 bg-gray-800 hover:bg-teal-800 text-gray-300 hover:text-gray py-3 px-4 text-lg rounded transition duration-200 ccdiscordjoinpre">
                    <span class="ccdiscordjoin">Join our Discord</span>
                </button>
            </a>
        </div>
        <div class="w-full sm:w-3/5 md:w-1/2">
            <iframe src="https://e.widgetbot.io/channels/{{ page.discordServerID }}/{{ page.discordChannelID }}" class="ccinfoframe mx-auto my-12 lg:float-right xl:mr-8 rounded-lg shadow-xl" title="{{ page.serverName }} Discord embed" style="background-color:#36393f;"></iframe>
        </div>
    </div>

    <div id="sites" class="flex flex-wrap w-full justify-center items-center sm:w-5/6 md:w-11/12 xl:w-4/5 pb-16 lg:py-16 sm:mx-auto">
        {% for clink in page.cellLinks %}
            <div class="w-full lg:w-1/3">
                <a href="{% if clink.curl %}{{ clink.curl }}{% else %}#top{% endif %}" rel="noopener"{% if clink.other %} {{ clink.other }}{% endif %}>
                    <div class="w-11/12 my-1 mx-auto md:my-2 h-40 lg:h-64 rounded-lg bg-gray-700 overflow-hidden shadow-xl cbsitehover2 relative cursor-pointer fade-in-fwd">
                        <div class="bg-center bg-cover absolute cbsitehover" style="background-image: url('{{ clink.cimage }}');">
                        </div>
                        <div class="px-4 py-2 w-full h-full bottom-0 bg-transparent cursor-default pointer-events-none absolute z-10">
                            <div class="absolute" style="top:50%;left:50%;transform:translate(-50%, -50%);">
                                <button class="w-auto bg-gray-800 text-gray-300 hover:text-gray py-3 px-6 text-lg rounded">
                                    <span>{{ clink.cname }}</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </a>
            </div>
        {% endfor %}
    </div>

    <div class="w-full pb-8 text-center">
        <a href="{% if page.siteFooterlink %}{{ page.siteFooterlink }}{% elsif page.siteURL %}{{ page.siteURL }}{% else %}https://github.com/coffeebank/moonrise{% endif %}" rel="noopener" style="color:#888;" title="Legal">&copy; {{ page.siteYear }}<script>new Date().getFullYear()>{{ page.siteYear }}&&document.write("&#8208;"+new Date().getFullYear());</script> {{ page.serverName }}</a>
    </div>

    <script>
    // Handling errors
    function handleErrors(response) {
        if (!response.ok) {
            document.getElementById('serverStatus').innerHTML = ``
            document.getElementById('serverStatusM').innerHTML = ``
            document.getElementById('serverLogoName').classList.remove('hidden');
        }
        return response;
    }

    // Fetch API, mcsrvstat
    fetch('https://api.mcsrvstat.us/2/{{ page.serverIP }}')
        .then(handleErrors)
        .then(response => {
            return response.json()
        })
        .then(data => {
            if (data.online == true) {
                document.getElementById('serverStatus').innerHTML = `<p class="font-bold select-none"><span class="text-green-600">&#11044;</span>&emsp;We're online!&ensp;&middot;&ensp;${data.players.online} playing</p>`
                document.getElementById('serverStatusM').innerHTML = `<p class="font-bold select-none"><span class="text-green-600">&#11044;</span>&emsp;Online, ${data.players.online} playing</p>`
                document.getElementById('serverVer').innerHTML = `Minecraft ${data.version} Server`
            }
            else {
                document.getElementById('serverStatus').innerHTML = `<p class="font-bold select-none"><span class="text-red-600">&#11044;</span>&emsp;Sorry! We're offline...</p>`
                document.getElementById('serverStatusM').innerHTML = `<p class="font-bold select-none"><span class="text-red-600">&#11044;</span>&emsp;Offline</p>`
                document.getElementById('serverPlaynow').innerHTML = `<span class="inline-block bg-red-500 rounded-full px-3 py-1 text-sm font-thin uppercase text-gray-900 mr-2 shadow-lg">Currently Offline</span>`
                document.getElementById("serverIP").classList.remove('bg-green-900');
                document.getElementById("serverIP").classList.add('bg-orange-800');
            }
        })
    </script>

    <!-- set up clipboardjs and snackbar confirmation -->
    <script src="clipboard.min.js"></script>
    <div id="snackbar" class="text-gray-100 bg-green-900 p-3 rounded shadow-xl">Copied!</div>
    <script>
        new ClipboardJS('p#serverIP');
        var clipboard = new ClipboardJS('p#serverIP');
        var getsnack = document.getElementById("snackbar");

        clipboard.on('success', function(e) {
            getsnack.classList.add('show');
            setTimeout(function(){ getsnack.classList.remove('show'); }, 2500);
        });

        clipboard.on('error', function(e) {
            console.error('Action:', e.action);
            console.error('Trigger:', e.trigger);
        });
    </script>
</body>
</html>